{% extends "base.html" %}
{% from "macros.html" import render_submit_button %}

{% block title %}Edit {{ job.role }} - Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-gradient">
                <i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Edit Opportunity
            </h2>
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2" aria-hidden="true"></i>Back to Dashboard
            </a>
        </div>

        <div class="card admin-card">
            <div class="card-body p-4">
                <form method="POST" novalidate data-autosave="true" id="editJobForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <!-- Type Selection -->
                    <div class="mb-3">
                        <label class="form-label required" for="opportunityType">
                            <i class="bi bi-tag me-2" aria-hidden="true"></i>Opportunity Type
                        </label>
                        <select class="form-select" name="opportunity_type" id="opportunityType" required onchange="toggleFields()">
                            <option value="full_time" {% if not job.is_internship and not job.is_hackathon %}selected{% endif %}>Full Time Job</option>
                            <option value="internship" {% if job.is_internship %}selected{% endif %}>Internship</option>
                            <option value="hackathon" {% if job.is_hackathon %}selected{% endif %}>Hackathon</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required" for="company_name">
                                <i class="bi bi-building me-2" aria-hidden="true"></i>
                                <span id="companyLabel">
                                    {% if job.is_hackathon %}Event/Platform Name{% else %}Company Name{% endif %}
                                </span>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   name="company_name"
                                   id="company_name"
                                   value="{{ job.company_name }}"
                                   required
                                   pattern="[A-Za-z0-9\s&.-]{2,100}"
                                   title="Company name (2-100 characters)">
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label required" for="role">
                                <i class="bi bi-briefcase me-2" aria-hidden="true"></i>
                                <span id="roleLabel">
                                    {% if job.is_hackathon %}Hackathon Title{% else %}Role{% endif %}
                                </span>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   name="role"
                                   id="role"
                                   value="{{ job.role }}"
                                   required
                                   pattern="[A-Za-z0-9\s&.-]{2,100}"
                                   title="Role title (2-100 characters)">
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label required" for="location">
                            <i class="bi bi-geo-alt me-2" aria-hidden="true"></i>Location
                        </label>
                        <input type="text"
                               class="form-control"
                               name="location"
                               id="location"
                               value="{{ job.location }}"
                               placeholder="e.g., Bangalore, Remote, Mumbai"
                               required>
                        <div class="invalid-feedback"></div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="batch_names">
                            <i class="bi bi-calendar-check me-2" aria-hidden="true"></i>Eligible Batches
                        </label>
                        <input type="text"
                               class="form-control"
                               name="batch_names"
                               id="batch_names"
                               value="{{ job.batch_names }}"
                               placeholder="e.g., 2024, 2025, 2026">
                        <div class="form-text">Enter batch years separated by commas (optional)</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label required" for="description">
                            <i class="bi bi-file-text me-2" aria-hidden="true"></i>Description
                        </label>
                        <textarea class="form-control"
                                  name="description"
                                  id="description"
                                  rows="5"
                                  required
                                  minlength="50"
                                  maxlength="2000">{{ job.description }}</textarea>
                        <div class="form-text">Provide a detailed description (50-2000 characters)</div>
                        <div class="invalid-feedback"></div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label required" for="apply_link">
                            <i class="bi bi-link-45deg me-2" aria-hidden="true"></i>
                            <span id="linkLabel">
                                {% if job.is_hackathon %}Registration Link{% else %}Application Link{% endif %}
                            </span>
                        </label>
                        <input type="url"
                               class="form-control"
                               name="apply_link"
                               id="apply_link"
                               value="{{ job.apply_link }}"
                               placeholder="https://"
                               required>
                        <div class="invalid-feedback"></div>
                    </div>

                    <!-- Dynamic Fields -->
                    <div id="fullTimeFields" {% if job.is_internship or job.is_hackathon %}class="dynamic-field hidden"{% endif %}>
                        <div class="mb-3">
                            <label class="form-label" for="salary">
                                <i class="bi bi-cash-stack me-2" aria-hidden="true"></i>Salary (LPA)
                            </label>
                            <input type="number"
                                   class="form-control"
                                   name="salary"
                                   id="salary"
                                   value="{{ job.salary or '' }}"
                                   placeholder="e.g., 5"
                                   step="0.01"
                                   min="0"
                                   max="100">
                            <div class="form-text">Leave empty if not disclosed</div>
                        </div>
                    </div>

                    <div id="internshipFields" {% if not job.is_internship %}class="dynamic-field hidden"{% endif %}>
                        <div class="mb-3">
                            <label class="form-label" for="stipend">
                                <i class="bi bi-cash-stack me-2" aria-hidden="true"></i>Stipend (per month)
                            </label>
                            <input type="number"
                                   class="form-control"
                                   name="stipend"
                                   id="stipend"
                                   value="{{ job.stipend or '' }}"
                                   placeholder="e.g., 15000"
                                   step="0.01"
                                   min="0">
                            <div class="form-text">Leave empty for unpaid internships</div>
                        </div>
                    </div>

                    <div id="hackathonFields" {% if not job.is_hackathon %}class="dynamic-field hidden"{% endif %}>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="prize_money">
                                    <i class="bi bi-trophy me-2" aria-hidden="true"></i>Prize Money (â‚¹)
                                </label>
                                <input type="number"
                                       class="form-control"
                                       name="prize_money"
                                       id="prize_money"
                                       value="{{ job.prize_money or '' }}"
                                       placeholder="e.g., 100000"
                                       step="0.01"
                                       min="0">
                                <div class="form-text">Total prize pool</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="deadline">
                                    <i class="bi bi-calendar-event me-2" aria-hidden="true"></i>Registration Deadline
                                </label>
                                <input type="date"
                                       class="form-control"
                                       name="deadline"
                                       id="deadline"
                                       value="{% if job.deadline %}{{ job.deadline.strftime('%Y-%m-%d') }}{% endif %}">
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mt-4">
                        {{ render_submit_button('Save Changes', 'check-circle', 'primary', 'Saving...') }}
                        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-2" aria-hidden="true"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
{% endblock %}